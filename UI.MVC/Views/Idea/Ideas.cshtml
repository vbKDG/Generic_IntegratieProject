@using D.UI.MVC.Models.Ideas
@using Domain
@model D.UI.MVC.Models.Ideas.IdeasVM

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script type="text/javascript" src="~/js/toastr.js"></script>
<link rel="stylesheet" href="~/css/toastr.css">
<script src="~/js/showReactionsReport.js" asp-append-version="true"></script>
<link rel="stylesheet" href="~/css/reportPopUp.css">
<link rel="stylesheet" href="~/css/modal.css">

<script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>

<h1>Ideas</h1>
@Html.ActionLink("Create Idea", "CreateIdeaPage", "Idea"
    , new { ideationId=@Model.IdeationId})

<table class="table">
    <tr>
        <th>
            <p>Ideas</p>
        </th>
    </tr>
    @for (var i = 0; i < Model.ideas.Count; i++)
    {
        if (Model.ideas.ToList()[i].Disapproved == false)
        {
             <tr>
                <td>
                    <b>@Model.ideas.ToList()[i].User.FirstName @Model.ideas.ToList()[i].User.LastName.Substring(0,1). </b>
                    @if (@Model.ideas.ToList()[i].Verified)
                    {
                        <i class="glyphicon glyphicon-ok-circle"></i>
                    }
                    @if (User.Identity.IsAuthenticated)
                    {
                        <button id="likeIdea-@Model.ideas.ToList()[i].IdeaId" type="button" 
                                onclick="location.href='@Url.Action("LikeIdea", "Idea"
                               , new {ideaId = @Model.ideas.ToList()[i].IdeaId})', userLikedIdea()" >Like</button>
                        <span id="ideaLikeCount-@Model.ideas.ToList()[i].IdeaId">(@Model.ideas.ToList()[i].IdeaLikes.Count)</span><br>
                    }
                    else
                    {
                        <button title="You have to be signed in">Like</button>
                        <span>(@Model.ideas.ToList()[i].IdeaLikes.Count)</span><br>
                    }
                    @foreach (var field in Model.fields)
                    {
                        if (Model.ideas.ToList()[i].IdeaId == field.Idea.IdeaId)
                        {
                            @field.Text
                            <br>
                        }
                    }
                    @if (User.Identity.IsAuthenticated)
                    {
                        <button onclick="showPopup(@Model.ideas.ToList()[i].IdeaId, 'idea', 0);">Report idea</button><br>
                    }
                    else
                    {
                        <button title="You have to be signed in to report an idea">Report idea</button><br>
                    }
                    
                    <button id="showReactions-@i">Show reactions</button>
                    <div id="reactions-@i">
                        @foreach (var reaction in Model.reactions.ToList())
                        {
                            if (reaction.Disapproved == false)
                            {
                                if (reaction.Idea.IdeaId == @Model.ideas.ToList()[i].IdeaId)
                                {
                                    <b>@reaction.User.FirstName @reaction.User.LastName.Substring(0,1).</b>
                                    if (@reaction.Verified)
                                    {
                                        <i class="glyphicon glyphicon-ok-circle"></i>
                                    }
                                    @reaction.Content
                                    <button id="likeReaction-@reaction.ReactionId" type="button" 
                                            onclick="location.href='@Url.Action("LikeReaction", "Idea"
                                              , new {reactionId = @reaction.ReactionId})', userLikedReaction()" >Like</button>
                                    <span id="reactionLikeCount-@reaction.ReactionId">(@reaction.ReactionLikes.Count)</span>
                                    if (User.Identity.IsAuthenticated)
                                    {
                                        <button onclick="showPopup(@reaction.Idea.IdeaId, 'reaction', @reaction.ReactionId)">Report reaction</button><br>
                                    }
                                    else
                                    {
                                        <button title="You have to be signed in to report a reaction">Report reaction</button><br>
                                    }
                                }
                            }
                            else
                            {
                                <b>@reaction.User.FirstName @reaction.User.LastName.Substring(0,1).</b>
                                <span>(@reaction.ReactionLikes.Count)</span>
                                <span class="text-danger">This reaction has been blocked!</span><br>
                            }
                        }
                        <div id="newReaction-@Model.ideas.ToList()[i].IdeaId"></div>
                        <div>
                            @using (Html.BeginForm("ReactIdea", "Idea",
                                FormMethod.Post))
                            {
                                <p>Write your own reaction: </p>
                                <input name="reaction" id="reaction-@Model.ideas.ToList()[i].IdeaId" type="text" />
                                <input name="idea" value="@Model.ideas.ToList()[i].IdeaId" type="hidden" />
                                <button id="submitReaction-@Model.ideas.ToList()[i].IdeaId" type="submit" onclick="userSubmittedReaction()">React</button>
                            }
                        </div>
                    </div>
                </td>
            </tr>
        }
        else
        {
            <tr>
                <td>
                    @Model.ideas.ToList()[i].User.FirstName @Model.ideas.ToList()[i].User.LastName.Substring(0,1).
                    <span>(@Model.ideas.ToList()[i].IdeaLikes.Count)</span><br>
                    <span class="text-danger">This idea has been blocked!</span>
                </td>
            </tr>
        }
    }
</table>

<div id="blur" name="blur"></div>
<div id="popup" name="popup">
    <div name="popupContent" id="popupContent">
        <div name="inputArea" id="inputArea">
            <p id="titelRep">Why do you want to report this 
                <span id="reportType"></span>?
            </p>
            <div id="repTextContainer">
                <textarea id="reportText" name="reportText"></textarea>
            </div>
        </div>
        <div name="successMessage" id="successMessage">
            <img src="/images/green_check.png" id="succesImg" />
            <p>Your report has been successfully submitted.</p>
        </div>
        <div name="failureMessage" id="failureMessage">
            <img src="/images/red_cross.jpg" id="failureImgr"/>
            <p>Something went wrong, please try again later.</p>
        </div>
    </div>
    <div id="submitReportContainer">
        <button onclick="submitReportIdea(), userSubmittedReport()" id="submitButton">Submit</button><button onclick="closePopup()">Close</button>
    </div>
</div>
<div class="container">
<button type="button" class="btn btn-info btn-lg" data-target="#MyModal" data-toggle="modal"> SAFE THE BIRDS </button>
<div class="modal" id="MyModal" role="dialog">
    <div id="content" class="modal-dialog modal-lg">
       
        
    </div>
    <script>
        $(document).ready(function() {
            $("#content").load("/Idea/Idea");
        });
    </script>
    
</div>
</div>
